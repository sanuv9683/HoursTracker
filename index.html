<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Time Tracker</title>
  <!-- Bootstrap CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding-bottom: 70px; } /* space for bottom navbar */
    .navbar-brand { font-weight: 600; }
    .card { border-radius: .75rem; }
    .form-control, .form-floating > .form-control { height: calc(3rem + 2px); }
  </style>
</head>
<body>
<!-- Header -->
<nav class="navbar navbar-dark bg-primary">
  <div class="container-fluid">
    <span class="navbar-brand mb-0 h1">Time Tracker</span>
  </div>
</nav>

<main class="container-fluid mt-3 px-2">
  <!-- Entry Form -->
  <div class="card mb-3 shadow-sm">
    <div class="card-body">
      <form id="entryForm" class="row g-2">
        <div class="col-12">
          <div class="form-floating">
            <input type="date" class="form-control" id="workDate" placeholder="Date" required>
            <label for="workDate">Date</label>
          </div>
        </div>
        <div class="col-6">
          <div class="form-floating">
            <input type="time" class="form-control" id="checkIn" placeholder="Check-in" required>
            <label for="checkIn">Check-in</label>
          </div>
        </div>
        <div class="col-6">
          <div class="form-floating">
            <input type="time" class="form-control" id="checkOut" placeholder="Check-out" required>
            <label for="checkOut">Check-out</label>
          </div>
        </div>
        <div class="col-12 text-end">
          <button type="submit" class="btn btn-primary w-100 w-sm-auto">Add Entry</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Entries Table -->
  <div class="table-responsive mb-5">
    <table class="table table-striped align-middle" id="entriesTable">
      <thead class="table-primary">
      <tr>
        <th scope="col">Date</th>
        <th scope="col">Check-in</th>
        <th scope="col">Check-out</th>
        <th scope="col">Duration</th>
      </tr>
      </thead>
      <tbody></tbody>
      <tfoot class="table-secondary">
      <tr>
        <th colspan="3" class="text-end">Monthly Total</th>
        <th id="monthlyTotal">0h 0m</th>
      </tr>
      </tfoot>
    </table>
  </div>
</main>

<!-- Bottom Actions -->
<nav class="navbar fixed-bottom navbar-light bg-light border-top">
  <div class="container-fluid d-flex justify-content-around">
    <button id="generatePdf" class="btn btn-outline-primary btn-sm">PDF</button>
    <button id="shareWhatsapp" class="btn btn-outline-success btn-sm">WhatsApp</button>
    <button id="clearData" class="btn btn-outline-danger btn-sm">Clear</button>
  </div>
</nav>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.4.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
<script>
  let entries = JSON.parse(localStorage.getItem('entries') || '[]');
  const form = document.getElementById('entryForm');
  const tableBody = document.querySelector('#entriesTable tbody');
  const monthlyTotalEl = document.getElementById('monthlyTotal');
  const generatePdfBtn = document.getElementById('generatePdf');
  const shareWhatsappBtn = document.getElementById('shareWhatsapp');
  const clearDataBtn = document.getElementById('clearData');

  form.addEventListener('submit', e => {
    e.preventDefault();
    const date = document.getElementById('workDate').value;
    const checkIn = document.getElementById('checkIn').value;
    const checkOut = document.getElementById('checkOut').value;
    if (checkOut <= checkIn) { alert('Check-out must be after check-in'); return; }
    entries.push({ date, checkIn, checkOut });
    localStorage.setItem('entries', JSON.stringify(entries));
    form.reset(); renderTable();
  });

  function renderTable() {
    tableBody.innerHTML = '';
    let totalMinutes = 0;
    entries.forEach(e => {
      const [inH, inM] = e.checkIn.split(':').map(Number);
      const [outH, outM] = e.checkOut.split(':').map(Number);
      const diff = (outH*60 + outM) - (inH*60 + inM);
      totalMinutes += diff;
      const h = Math.floor(diff/60), m = diff % 60;
      const row = `<tr><td>${e.date}</td><td>${e.checkIn}</td><td>${e.checkOut}</td><td>${h}h ${m}m</td></tr>`;
      tableBody.insertAdjacentHTML('beforeend', row);
    });
    const mH = Math.floor(totalMinutes/60), mM = totalMinutes % 60;
    monthlyTotalEl.textContent = `${mH}h ${mM}m`;
  }

  generatePdfBtn.addEventListener('click', () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(18);
    doc.text('Time Tracker Report', 14, 20);
    const head = [['Date','Check-in','Check-out','Duration']];
    const body = entries.map(e => {
      const [inH,inM] = e.checkIn.split(':').map(Number);
      const [outH,outM] = e.checkOut.split(':').map(Number);
      const diff = (outH*60+outM)-(inH*60+inM);
      const h=Math.floor(diff/60), m=diff%60;
      return [e.date,e.checkIn,e.checkOut,`${h}h ${m}m`];
    });
    doc.autoTable({ head, body, startY:30 });
    doc.text(`Monthly Total: ${monthlyTotalEl.textContent}`,14, doc.lastAutoTable.finalY+10);
    doc.save('time-tracker-report.pdf');
  });

  shareWhatsappBtn.addEventListener('click', () => {
    let msg='Time Tracker Report:%0A';
    entries.forEach(e => {
      const [inH,inM]=e.checkIn.split(':').map(Number);
      const [outH,outM]=e.checkOut.split(':').map(Number);
      const diff=(outH*60+outM)-(inH*60+inM);
      const h=Math.floor(diff/60), m=diff%60;
      msg+=`${e.date}: ${e.checkIn}-${e.checkOut} (${h}h ${m}m)%0A`;
    });
    msg+=`Monthly Total: ${monthlyTotalEl.textContent}`;
    window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`,'_blank');
  });

  clearDataBtn.addEventListener('click', () => {
    if (confirm('Clear all entries?')) { entries=[]; localStorage.removeItem('entries'); renderTable(); }
  });

  renderTable();
</script>
</body>
</html>

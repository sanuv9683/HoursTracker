<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Achi's Time Tracker App</title>
  <!-- jsPDF and AutoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
    .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    h1 { text-align: center; margin-bottom: 20px; }
    form { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
    form input, form button { padding: 8px; font-size: 1rem; }
    button { cursor: pointer; margin-right: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #f0f0f0; }
    tfoot th { background: #e0e0e0; }
  </style>
</head>
<body>
<div class="container">
  <h1>Monthly Hours Tracker</h1>
  <form id="entryForm">
    <input type="date" id="workDate" required>
    <input type="time" id="checkIn" required>
    <input type="time" id="checkOut" required>
    <button type="submit">Add Entry</button>
  </form>
  <div style="margin-bottom: 20px;">
    <button id="generatePdf">Generate PDF</button>
    <button id="shareWhatsapp">Share on WhatsApp</button>
    <button id="clearData">Clear All</button>
  </div>
  <table id="entriesTable">
    <thead>
    <tr><th>Date</th><th>Check-in</th><th>Check-out</th><th>Duration</th></tr>
    </thead>
    <tbody></tbody>
    <tfoot>
    <tr><th colspan="3">Monthly Total</th><th id="monthlyTotal">0h 0m</th></tr>
    </tfoot>
  </table>
</div>

<script>
  // Initialize entries
  let entries = JSON.parse(localStorage.getItem('entries') || '[]');

  const form = document.getElementById('entryForm');
  const tableBody = document.querySelector('#entriesTable tbody');
  const monthlyTotalEl = document.getElementById('monthlyTotal');
  const generatePdfBtn = document.getElementById('generatePdf');
  const shareWhatsappBtn = document.getElementById('shareWhatsapp');
  const clearDataBtn = document.getElementById('clearData');

  // Add new entry
  form.addEventListener('submit', e => {
    e.preventDefault();
    const date = document.getElementById('workDate').value;
    const checkIn = document.getElementById('checkIn').value;
    const checkOut = document.getElementById('checkOut').value;
    if (checkOut <= checkIn) { alert('Check-out must be after check-in'); return; }
    entries.push({ date, checkIn, checkOut });
    localStorage.setItem('entries', JSON.stringify(entries));
    form.reset();
    renderTable();
  });

  // Render table and totals
  function renderTable() {
    tableBody.innerHTML = '';
    let totalMinutes = 0;
    entries.forEach(e => {
      const inT = e.checkIn.split(':').map(Number);
      const outT = e.checkOut.split(':').map(Number);
      const diff = (outT[0]*60 + outT[1]) - (inT[0]*60 + inT[1]);
      totalMinutes += diff;
      const hours = Math.floor(diff/60);
      const mins = diff % 60;
      const row = `<tr><td>${e.date}</td><td>${e.checkIn}</td><td>${e.checkOut}</td><td>${hours}h ${mins}m</td></tr>`;
      tableBody.insertAdjacentHTML('beforeend', row);
    });
    const mH = Math.floor(totalMinutes/60);
    const mM = totalMinutes % 60;
    monthlyTotalEl.textContent = `${mH}h ${mM}m`;
  }

  // Generate PDF report
  generatePdfBtn.addEventListener('click', () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(18);
    doc.text('Time Tracker Report', 14, 20);
    const head = [['Date', 'Check-in', 'Check-out', 'Duration']];
    const body = entries.map(e => {
      const inT = e.checkIn.split(':').map(Number);
      const outT = e.checkOut.split(':').map(Number);
      const diff = (outT[0]*60 + outT[1]) - (inT[0]*60 + inT[1]);
      const h = Math.floor(diff/60);
      const m = diff % 60;
      return [e.date, e.checkIn, e.checkOut, `${h}h ${m}m`];
    });
    doc.autoTable({ head, body, startY: 30 });
    doc.text(`Monthly Total: ${monthlyTotalEl.textContent}`, 14, doc.lastAutoTable.finalY + 10);
    doc.save('time-tracker-report.pdf');
  });

  // Share on WhatsApp
  shareWhatsappBtn.addEventListener('click', () => {
    let msg = 'Time Tracker Report:\n';
    entries.forEach(e => {
      const inT = e.checkIn.split(':').map(Number);
      const outT = e.checkOut.split(':').map(Number);
      const diff = (outT[0]*60 + outT[1]) - (inT[0]*60 + inT[1]);
      const h = Math.floor(diff/60);
      const m = diff % 60;
      msg += `${e.date}: ${e.checkIn} - ${e.checkOut} (${h}h ${m}m)\n`;
    });
    msg += `Monthly Total: ${monthlyTotalEl.textContent}`;
    const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`;
    window.open(url, '_blank');
  });

  // Clear all data
  clearDataBtn.addEventListener('click', () => {
    if (confirm('Clear all entries?')) {
      entries = [];
      localStorage.removeItem('entries');
      renderTable();
    }
  });

  // Initial render
  renderTable();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Sudu's Time Tracker</title>
    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            padding-top: 47px;
            padding-bottom: 80px;
        }

        /* space for bottom navbar */
        .navbar-brand {
            font-weight: 600;
        }

        .card {
            border-radius: .75rem;
        }

        .form-control, .form-floating > .form-control {
            height: calc(3rem + 2px);
        }

        /* Modern floating buttons */
        .bottom-nav {
            position: fixed;
            bottom: 23px;
            width: 100%;
            background: #ffffff;
            padding: 0.3rem 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            pointer-events: none;
            box-shadow: 2px 9px 20px 0px #231e1e;
        }

        .btn-floating {
            pointer-events: all;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: #fff;
            border: none;
            transition: transform 0.1s;
        }

        .btn-floating:active {
            transform: scale(0.9);
        }

        .btn-pdf {
            background: #4a90e2;
            box-shadow: 0 4px 8px rgba(74, 144, 226, 0.4);
        }

        .btn-whatsapp {
            background: #25D366;
            box-shadow: 0 4px 8px rgba(37, 211, 102, 0.4);
        }

        .btn-clear {
            background: #dc3545;
            box-shadow: 0 4px 8px rgba(220, 53, 69, 0.4);
        }

        /* Footer */
        .app-footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #f8f9fa;
            padding: 0;
            text-align: center;
            font-size: .875rem;
            color: #6c757d;
            border-top: 2px solid #dee2e6;
        }

        .app-footer a {
            color: #6c757d;
            text-decoration: none;
        }

        .app-footer a:hover {
            text-decoration: underline;
        }

        /* Table styling */
        #entriesTable {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            font-size: 0.95rem;
            border-collapse: separate;
            border-spacing: 0;
            overflow: hidden;
            border-radius: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        #entriesTable thead th {
            background: linear-gradient(90deg, #4a90e2, #357ABD);
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border: none;
            /*padding: 0.75rem 1rem;*/
        }

        #entriesTable tbody tr:nth-child(even) {
            background-color: #f7f9fc;
        }

        #entriesTable td, #entriesTable th {
            /*padding: 0.75rem 1rem;*/
            vertical-align: middle;
            border-bottom: 1px solid #e9ecef;
        }

        #entriesTable tfoot th {
            background: #f1f3f5;
            border-top: 2px solid #dee2e6;
            padding: 0.75rem 1rem;
        }

        .action-btn {
            margin: 0 0.2rem;
            font-size: 0.9rem;
            color: #495057;
            background: transparent;
            border: none;
            padding: 0;
        }

        .action-btn:hover {
            color: #212529;
        }

        .table > thead {
            font-size: 10px;
        }

        .table > tbody {
            font-size: 10px;
        }

        tfoot {
            font-size: 13px;
        }
    </style>
</head>
<body>
<!-- Header -->
<nav class="navbar fixed-top navbar-dark bg-primary">
    <div class="container-fluid">
        <span class="navbar-brand mb-0 h1">Sudu's Time Tracker</span>
    </div>
</nav>

<main class="container-fluid mt-3 px-2">
    <!-- Entry Form -->
    <div class="card mb-3 shadow-sm">
        <div class="card-body">
            <form class="row g-2" id="entryForm">
                <input id="editIndex" type="hidden" value="-1">
                <div class="col-12">
                    <div class="form-floating">
                        <input class="form-control" id="workDate" placeholder="Date" required type="date">
                        <label for="workDate">Date</label>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-floating">
                        <input class="form-control" id="checkIn" placeholder="Check-in" required type="time">
                        <label for="checkIn">Check-in</label>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-floating">
                        <input class="form-control" id="checkOut" placeholder="Check-out" required type="time">
                        <label for="checkOut">Check-out</label>
                    </div>
                </div>
                <div class="col-12 text-end">
                    <button class="btn btn-primary w-100 w-sm-auto" type="submit">
                        <i class="bi bi-save"></i> <span id="formBtnText">Add Entry</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Entries Table -->
    <div class="table-responsive mb-5">
        <table class="table" id="entriesTable">
            <thead>
            <tr>
                <th>Date</th>
                <th>Check-in</th>
                <th>Check-out</th>
                <th>Duration</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
            <tr>
                <th class="text-end" colspan="3">Monthly Total</th>
                <th id="monthlyTotal">0h 0m</th>
                <th></th>
            </tr>
            </tfoot>
        </table>
    </div>
</main>

<!-- Bottom Floating Buttons -->
<div class="bottom-nav">
    <button aria-label="Generate PDF" class="btn-floating btn-pdf" id="generatePdf"><i
            class="bi bi-file-earmark-text"></i></button>
    <button aria-label="Share on WhatsApp" class="btn-floating btn-whatsapp" id="shareWhatsapp"><i
            class="bi bi-whatsapp"></i></button>
    <button aria-label="Clear all entries" class="btn-floating btn-clear" id="clearData"><i class="bi bi-trash"></i>
    </button>
</div>

<!-- Footer -->
<footer class="app-footer">
    Â© 2025 All rights reserved. Developed by <a href="https://akrivo.uk" rel="noopener" target="_blank">AKRIVO LTD</a>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.4.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
<script>
    let entries = JSON.parse(localStorage.getItem('entries') || '[]');
    const form = document.getElementById('entryForm');
    const tableBody = document.querySelector('#entriesTable tbody');
    const monthlyTotalEl = document.getElementById('monthlyTotal');
    const generatePdfBtn = document.getElementById('generatePdf');
    const shareWhatsappBtn = document.getElementById('shareWhatsapp');
    const clearDataBtn = document.getElementById('clearData');
    const editIndexInput = document.getElementById('editIndex');
    const formBtnText = document.getElementById('formBtnText');

    form.addEventListener('submit', e => {
        e.preventDefault();
        const date = document.getElementById('workDate').value;
        const checkIn = document.getElementById('checkIn').value;
        const checkOut = document.getElementById('checkOut').value;
        if (checkOut <= checkIn) {
            Swal.fire({icon: 'error', title: 'Invalid Time', text: 'Check-out must be after check-in'});
            return;
        }
        const entry = {date, checkIn, checkOut};
        const idx = parseInt(editIndexInput.value, 10);
        if (idx >= 0) {
            entries[idx] = entry;
            Swal.fire({icon: 'success', title: 'Entry Updated', showConfirmButton: false, timer: 1500});
        } else {
            entries.push(entry);
            Swal.fire({icon: 'success', title: 'Entry Added', showConfirmButton: false, timer: 1500});
        }
        localStorage.setItem('entries', JSON.stringify(entries));
        form.reset();
        editIndexInput.value = -1;
        formBtnText.textContent = 'Add Entry';
        renderTable();
    });

    function renderTable() {
        tableBody.innerHTML = '';
        let totalMinutes = 0;
        entries.forEach((e, i) => {
            const [inH, inM] = e.checkIn.split(':').map(Number);
            const [outH, outM] = e.checkOut.split(':').map(Number);
            const diff = (outH * 60 + outM) - (inH * 60 + inM);
            totalMinutes += diff;
            const h = Math.floor(diff / 60), m = diff % 60;
            const row = document.createElement('tr');
            row.innerHTML = `
        <td>${e.date}</td>
        <td>${e.checkIn}</td>
        <td>${e.checkOut}</td>
        <td>${h}h ${m}m</td>
        <td>
          <button class="action-btn" onclick="editEntry(${i})"><i class="bi bi-pencil-square"></i></button>
          <button class="action-btn" onclick="deleteEntry(${i})"><i class="bi bi-trash-fill"></i></button>
        </td>`;
            tableBody.appendChild(row);
        });
        const mH = Math.floor(totalMinutes / 60), mM = totalMinutes % 60;
        monthlyTotalEl.textContent = `${mH}h ${mM}m`;
    }

    window.deleteEntry = i => {
        Swal.fire({title: 'Delete this entry?', icon: 'warning', showCancelButton: true, confirmButtonText: 'Delete'})
            .then(res => {
                if (res.isConfirmed) {
                    entries.splice(i, 1);
                    localStorage.setItem('entries', JSON.stringify(entries));
                    renderTable();
                }
            });
    };

    window.editEntry = i => {
        const e = entries[i];
        document.getElementById('workDate').value = e.date;
        document.getElementById('checkIn').value = e.checkIn;
        document.getElementById('checkOut').value = e.checkOut;
        editIndexInput.value = i;
        formBtnText.textContent = 'Update Entry';
    };

    clearDataBtn.addEventListener('click', () => {
        Swal.fire({
            title: 'Are you sure?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, clear it!',
            cancelButtonText: 'Cancel'
        })
            .then(result => {
                if (result.isConfirmed) {
                    entries = [];
                    localStorage.removeItem('entries');
                    renderTable();
                    Swal.fire({icon: 'success', title: 'Cleared!', showConfirmButton: false, timer: 1500});
                }
            });
    });

    generatePdfBtn.addEventListener('click', () => {
        const {jsPDF} = window.jspdf;
        const doc = new jsPDF();
        doc.setFontSize(18);
        doc.text('Time Tracker Report', 14, 20);
        const head = [['Date', 'Check-in', 'Check-out', 'Duration']];
        const body = entries.map(e => {
            const [ih, im] = e.checkIn.split(':').map(Number);
            const [oh, om] = e.checkOut.split(':').map(Number);
            const d = (oh * 60 + om) - (ih * 60 + im);
            return [e.date, e.checkIn, e.checkOut, `${Math.floor(d / 60)}h ${d % 60}m`];
        });
        doc.autoTable({head, body, startY: 30});
        doc.text(`Monthly Total: ${monthlyTotalEl.textContent}`, 14, doc.lastAutoTable.finalY + 10);
        doc.save('time-tracker-report.pdf');
        Swal.fire({icon: 'success', title: 'PDF Downloaded', showConfirmButton: false, timer: 1500});
    });

    shareWhatsappBtn.addEventListener('click', () => {
        let msg = 'Time Tracker Report:%0A';
        entries.forEach(e => {
            const [ih, im] = e.checkIn.split(':').map(Number);
            const [oh, om] = e.checkOut.split(':').map(Number);
            const d = (oh * 60 + om) - (ih * 60 + im);
            msg += `${e.date}: ${e.checkIn}-${e.checkOut} (${Math.floor(d / 60)}h ${d % 60}m)%0A`;
        });
        msg += `Monthly Total: ${monthlyTotalEl.textContent}`;
        window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`, '_blank');
        Swal.fire({
            icon: 'info',
            title: 'WhatsApp',
            text: 'Sharing window opened',
            showConfirmButton: false,
            timer: 1500
        });
    });

    // Auto-set date input to today
    document.addEventListener('DOMContentLoaded', () => {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('workDate').value = today;
    });

    renderTable();
</script>
</body>
</html>

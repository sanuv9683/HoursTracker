<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Time Tracker</title>
  <!-- Bootstrap CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body { padding-top: 56px; padding-bottom: 80px; }
    .navbar-brand { font-weight: 600; }
    .card { border-radius: .75rem; }
    .form-control, .form-floating > .form-control { height: calc(3rem + 2px); }
    /* Sticky table header */
    .table-responsive thead th {
      position: sticky;
      top: 56px;
      z-index: 1020;
      background-color: #0d6efd;
      color: #fff;
    }
    /* Modern floating buttons */
    .bottom-nav {
      position: fixed;
      bottom: 23px;
      width: 100%;
      background: #ffffff;
      padding: 0.3rem 0;
      display: flex;
      justify-content: space-around;
      align-items: center;
      pointer-events: none;
      box-shadow: 2px 9px 20px 0px rgba(0,0,0,0.2);
    }
    .btn-floating {
      pointer-events: all;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.5rem;
      color: #fff;
      border: none;
      transition: transform 0.1s;
    }
    .btn-floating:active { transform: scale(0.9); }
    .btn-pdf { background: #4a90e2; box-shadow: 0 4px 8px rgba(74,144,226,0.4); }
    .btn-whatsapp { background: #25D366; box-shadow: 0 4px 8px rgba(37,211,102,0.4); }
    .btn-clear { background: #dc3545; box-shadow: 0 4px 8px rgba(220,53,69,0.4); }
    /* Footer */
    .app-footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #f8f9fa;
      padding: .5rem 0;
      text-align: center;
      font-size: .875rem;
      color: #6c757d;
      border-top: 1px solid #dee2e6;
    }
    .app-footer a { color: #6c757d; text-decoration: none; }
    .app-footer a:hover { text-decoration: underline; }
  </style>
</head>
<body>
<!-- Fixed Header -->
<nav class="navbar fixed-top navbar-dark bg-primary">
  <div class="container-fluid">
    <span class="navbar-brand mb-0 h1">Sudu's Time Tracker</span>
  </div>
</nav>

<main class="container-fluid mt-3 px-2">
  <!-- Entry Form -->
  <div class="card mb-3 shadow-sm">
    <div class="card-body">
      <form id="entryForm" class="row g-2">
        <div class="col-12">
          <div class="form-floating">
            <input type="date" class="form-control" id="workDate" placeholder="Date" required>
            <label for="workDate">Date</label>
          </div>
        </div>
        <div class="col-6">
          <div class="form-floating">
            <input type="time" class="form-control" id="checkIn" placeholder="Check-in" required>
            <label for="checkIn">Check-in</label>
          </div>
        </div>
        <div class="col-6">
          <div class="form-floating">
            <input type="time" class="form-control" id="checkOut" placeholder="Check-out" required>
            <label for="checkOut">Check-out</label>
          </div>
        </div>
        <div class="col-12 text-end">
          <button type="submit" class="btn btn-primary w-100 w-sm-auto">Add Entry</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Entries Table -->
  <div class="table-responsive mb-5">
    <table class="table table-striped align-middle" id="entriesTable">
      <thead class="table-primary">
      <tr>
        <th scope="col">Date</th>
        <th scope="col">Check-in</th>
        <th scope="col">Check-out</th>
        <th scope="col">Duration</th>
      </tr>
      </thead>
      <tbody></tbody>
      <tfoot class="table-secondary">
      <tr>
        <th colspan="3" class="text-end">Monthly Total</th>
        <th id="monthlyTotal">0h 0m</th>
      </tr>
      </tfoot>
    </table>
  </div>
</main>

<!-- Bottom Floating Buttons -->
<div class="bottom-nav">
  <button id="generatePdf" class="btn-floating btn-pdf" aria-label="Generate PDF">
    <i class="bi bi-file-earmark-text"></i>
  </button>
  <button id="shareWhatsapp" class="btn-floating btn-whatsapp" aria-label="Share on WhatsApp">
    <i class="bi bi-whatsapp"></i>
  </button>
  <button id="clearData" class="btn-floating btn-clear" aria-label="Clear all entries">
    <i class="bi bi-trash"></i>
  </button>
</div>

<!-- Footer -->
<footer class="app-footer">
  Â© 2025 All rights reserved. Developed by <a href="https://akrivo.uk" target="_blank" rel="noopener">akrivo.uk</a>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.4.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
<script>
  let entries = JSON.parse(localStorage.getItem('entries') || '[]');
  const form = document.getElementById('entryForm');
  const tableBody = document.querySelector('#entriesTable tbody');
  const monthlyTotalEl = document.getElementById('monthlyTotal');
  const generatePdfBtn = document.getElementById('generatePdf');
  const shareWhatsappBtn = document.getElementById('shareWhatsapp');
  const clearDataBtn = document.getElementById('clearData');

  form.addEventListener('submit', e => {
    e.preventDefault();
    const date = document.getElementById('workDate').value;
    const checkIn = document.getElementById('checkIn').value;
    const checkOut = document.getElementById('checkOut').value;
    if (checkOut <= checkIn) {
      Swal.fire({ icon: 'error', title: 'Invalid Time', text: 'Check-out must be after check-in' });
      return;
    }
    entries.push({ date, checkIn, checkOut });
    localStorage.setItem('entries', JSON.stringify(entries));
    form.reset(); renderTable();
  });

  function renderTable() {
    tableBody.innerHTML = '';
    let totalMinutes = 0;
    entries.forEach(e => {
      const [inH, inM] = e.checkIn.split(':').map(Number);
      const [outH, outM] = e.checkOut.split(':').map(Number);
      const diff = (outH*60 + outM) - (inH*60 + inM);
      totalMinutes += diff;
      const h = Math.floor(diff/60), m = diff % 60;
      const row = `<tr><td>${e.date}</td><td>${e.checkIn}</td><td>${e.checkOut}</td><td>${h}h ${m}m</td></tr>`;
      tableBody.insertAdjacentHTML('beforeend', row);
    });
    const mH = Math.floor(totalMinutes/60), mM = totalMinutes % 60;
    monthlyTotalEl.textContent = `${mH}h ${mM}m`;
  }

  generatePdfBtn.addEventListener('click', () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(18);
    doc.text('Time Tracker Report', 14, 20);
    const head = [['Date','Check-in','Check-out','Duration']];
    const body = entries.map(e => {
      const [inH,inM] = e.checkIn.split(':').map(Number);
      const [outH,outM] = e.checkOut.split(':').map(Number);
      const diff = (outH*60+outM)-(inH*60+inM);
      const h=Math.floor(diff/60), m=diff%60;
      return [e.date,e.checkIn,e.checkOut,`\${h}h \${m}m`];
    });
    doc.autoTable({ head, body, startY:30 });
    doc.text(`Monthly Total: ${monthlyTotalEl.textContent}`,14, doc.lastAutoTable.finalY+10);
    doc.save('time-tracker-report.pdf');
  });

  shareWhatsappBtn.addEventListener('click', () => {
    let msg='Time Tracker Report:%0A';
    entries.forEach(e => {
      const [inH,inM] = e.checkIn.split(':').map(Number);
      const [outH,outM] = e.checkOut.split(':').map(Number);
      const diff=(outH*60+outM)-(inH*60+inM);
      const h=Math.floor(diff/60), m=diff%60;
      msg+=`\${e.date}: \${e.checkIn}-\${e.checkOut} (\${h}h \${m}m)%0A`;
    });
    msg+=`Monthly Total: ${monthlyTotalEl.textContent}`;
    window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`, '_blank');
  });

  clearDataBtn.addEventListener('click', () => {
    Swal.fire({
      title: 'Clear all entries?\nThis cannot be undone.',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#dc3545',
      cancelButtonColor: '#6c757d',
      confirmButtonText: 'Yes, clear',
      cancelButtonText: 'Cancel'
    }).then(result => {
      if (result.isConfirmed) {
        entries = [];
        localStorage.removeItem('entries');
        renderTable();
        Swal.fire({ icon: 'success', title: 'Cleared', text: 'All entries have been cleared.' });
      }
    });
  });

  renderTable();
</script>
</body>
</html>
